<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Online Aero Parameter Identification | Spencer Folk </title> <meta name="author" content="Spencer Folk"> <meta name="description" content="Real-time aerodynamic parameter estimation for UAV propellers for applications in adaptive control."> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A4%96&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://spencerfolk.github.io/projects/project_aerocoeff/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Spencer Folk </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Online Aero Parameter Identification</h1> <p class="post-description">Real-time aerodynamic parameter estimation for UAV propellers for applications in adaptive control.</p> </header> <article> <p><strong>TL;DR:</strong> We synthesized an Extended Kalman Filter for identifying aerodynamic parameters (thrust/torque coefficients) for a quadrotor UAV in real time.</p> <hr> <p>In the Spring of 2022, I took ESE 650: Learning in Robotics, an elective as part of my robotics masters degree at the University of Pennsylvania. The course was marketed as a survey of methods spanning perception, planning, and control, but we ended up spending a large chunk of the semester digging deep into the principles of state estimation. While it certainly wasn’t my first exposure to Kalman filtering, it was the first time that the concept really clicked with me.</p> <p>For the final project of the course, I teamed up with a former labmate, Alexander, and we implemented an Extended Kalman Filter for estimating the thrust and drag torque coefficients of a quadrotor’s propellers using <em>only</em> measurements from the onboard gyroscope. The novelty with this work was that each propeller’s aerodynamic coefficients were estimated independently, whereas the vast majority of other works at the time assumed each propeller was identical. Let’s be real, in 99% of cases this is a <em>perfectly fine assumption</em>, but our approach would theoretically be useful in situations like where an individual propeller is damaged mid-flight.</p> <p>A lot of time was spent tuning the Kalman filter to converge within a fraction of a second (around 20-30 measurement updates). Once we got the filter to converge so fast, we had the idea to incorporate the estimated aerodynamic coefficients into a classical quadrotor trajectory tracking controller. In doing so, we essentially had a model-based adaptive controller! In simulation, we were able to nearly recover the tracking performance of a baseline “oracle” controller that had privileged knowledge of the correct aerodynamic coefficients from the start.</p> <p>We also wrote an automated nonlinear observability analysis to determine the minimum sensor suite (accelerometer, gyroscope, cameras, GPS, etc.) necessary to observe distinct propeller coefficients. The analysis also informed a condition where observability broke down: hover! This is pretty consequential because quadrotors are kind of designed to hover in place most of the time! If you look closely at the UAV state estimation literature, you’ll find the hover degeneracy for a lot of other filters too. In my humble opinion, only the good papers are going to acknowledge this up front…</p> <p>Anyways, eventually this project was abandoned after we tried to transition from simulation to hardware primarily because of two reasons:</p> <ol> <li>by construction, the filter required measurements of the propeller speeds and since our target platform was a <a href="https://www.bitcraze.io/products/old-products/crazyflie-2-1/" rel="external nofollow noopener" target="_blank">Crazyflie</a> with brushed motors, these measurements simply were not available; and</li> <li>we learned the reality that small changes in these aerodynamic coefficients don’t really matter that much as far as tracking control is concerned, because the lower level control is PID all the way down.</li> </ol> <p>The second point is a little nuanced and perhaps controversial. If you look at any popular open source flight stacks out there like PX4 or ArduPilot, you won’t see an explicit thrust or drag torque coefficient in the code. The closest thing you might find is a “control effectiveness value” for each axis or at best a dimensionless thrust coefficient. And yet, I can go and buy a new drone, upload the default parameters, and still get pretty good tracking control performance right off the bat. Why is this? Because the controllers for all of these open source autopilots rely on high frequency, high gain, closed-loop PID feedback control. When we transitioned to hardware, we quickly realized that propeller coefficients would only come into play <em>at the lowest level</em> of the control stack, the rate loop, which already benefits from high frequency feedback from the onboard gyroscope. A set of properly tuned PID gains coupled with high bandwidth control can effectively crush most model uncertainties, including in the aerodynamic coefficients.</p> <p>Now, that being said, there has been plenty of excellent research in recent years demonstrating improved tracking control with more-or-less explicit aerodynamic parameter identification, but these papers tend to be focused on specific cases like operating in ground effect or the aforementioned propeller damage scenario. Ultimately I think these sort of methods will enhance, but not replace, traditional PID feedback control for small rotary-wing UAVs. For larger UAVs (like autonomous helicopters) with less control bandwidths, this might be a <em>very</em> different story…</p> <p>All said and done, this project helped me build a strong foundation in state estimation which would be a strong influence on my later work on wind estimation. In fact, I spent upwards of two years after this class focusing my research on state estimation!</p> <p>For all the details on the methodology and our simulation results, feel free to check out our <a href="/assets/pdf/ese650_project_report.pdf">report</a>.</p> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Spencer Folk. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: April 02, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>